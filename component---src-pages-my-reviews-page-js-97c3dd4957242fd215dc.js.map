{"version":3,"file":"component---src-pages-my-reviews-page-js-97c3dd4957242fd215dc.js","mappings":"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","sources":["webpack://myweb3course/./src/components/reviews/my-reviews.js","webpack://myweb3course/./src/components/reviews/my-reviews-management.js","webpack://myweb3course/./src/pages/my-reviews-page.js"],"sourcesContent":["import React from \"react\";\r\nimport ReviewCard from \"./review-card\";\r\n\r\nconst MyReviews = ({ projects, setFilteredContents, allReviews }) => {\r\n  console.log(\"MYREVIEWS:\", projects);\r\n\r\n  console.log(\"ALL REVIEWS\", allReviews);\r\n  // Merge interesting data from allReviews within projects\r\n  const newProjects = projects.map((project) => {\r\n    const sameProjectWithOtherData = allReviews.find(\r\n      (element) => project.convertedProjectId === element._id\r\n    );\r\n    const newProject = {\r\n      ...project,\r\n      countExpected: sameProjectWithOtherData.countExpected,\r\n      countLiked: sameProjectWithOtherData.countLiked,\r\n      countReviews: sameProjectWithOtherData.countReviews,\r\n      projectReviews: sameProjectWithOtherData.projectReviews,\r\n    };\r\n    console.log(\"new proj:\", newProject);\r\n    return newProject;\r\n  });\r\n\r\n  if (!projects || projects.length <= 0) return null;\r\n\r\n  return (\r\n    <>\r\n      {newProjects.map((project, index) => (\r\n        <ReviewCard key={index} {...{ project, setFilteredContents }} />\r\n      ))}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default MyReviews;\r\n","import React, { useState, useEffect } from \"react\";\r\nimport Spinner from \"../spinner/spinner\";\r\n\r\nimport { useProjectData } from \"../context/projects/project-data-context\";\r\nimport { useReviewData } from \"../context/reviews/review-data-context\";\r\nimport MyReviews from \"./my-reviews\";\r\nimport MyReviewsSummary from \"./my-reviews-summary\";\r\n\r\nconst MyReviewsManagement = ({associatedProjectGroupName}) => {\r\n  // Get state from the provider\r\n  const { projectGroupData, updateProjectGroupData, userData, updateUserData } =\r\n    useProjectData();\r\n\r\n  const {\r\n    myReviewSummaryData,\r\n    updateMyReviewSummaryData,    \r\n    myReviewsData,\r\n    updateMyReviewsData,\r\n    allReviewsData,\r\n    updateAllReviewsData,\r\n    isLoaded,\r\n  } = useReviewData();\r\n\r\n  const [filteredContents, setFilteredContents] = useState(undefined);\r\n  const [query, setQuery] = useState(\"\");\r\n\r\n  const handleInputChange = (e) => {\r\n    const inputText = e.target.value;\r\n    setQuery(e.target.value);\r\n\r\n    const filteredData = myReviewsData.filter((content) => {\r\n      // destructure data from post frontmatter\r\n      const { shortId, name, description } = content;\r\n      return (\r\n        // standardize data with .toLowerCase()\r\n        // return true if the subject, skills...\r\n        // contains the query string\r\n        name.toLowerCase().includes(inputText.toLowerCase()) ||\r\n        description.toLowerCase().includes(inputText.toLowerCase()) ||\r\n        (inputText.length > 0 && parseInt(inputText) === shortId)\r\n      );\r\n    });\r\n\r\n    if (filteredData && filteredData.length > 0)\r\n      setFilteredContents(filteredData);\r\n    else setFilteredContents(undefined);\r\n  };\r\n\r\n  useEffect(() => {\r\n    // get data from APIs\r\n    getData();\r\n  }, []);\r\n\r\n  const getData = async () => {\r\n    try {\r\n      // Deal with project group data\r\n      const group = await updateProjectGroupData(associatedProjectGroupName);\r\n      // Deal with user role data {role:..., isAdmin:...}\r\n      const user = await updateUserData(associatedProjectGroupName);\r\n      // Deal with review data\r\n      const temp = await updateMyReviewSummaryData(user.userName, group._id);\r\n      const myReviewsTemp = await updateMyReviewsData(user.userName, group._id);\r\n      const allReviewsTemp = await updateAllReviewsData(group._id);     \r\n    } catch (error) {\r\n      console.error(\"getData:error\", error);\r\n    }\r\n  };\r\n  let startingDate;\r\n  if (projectGroupData) {\r\n    // get the starting date to a string (parse it as it is seen as a string the date from the API / MongoDB)\r\n    const options = {\r\n      weekday: \"long\",\r\n      year: \"numeric\",\r\n      month: \"long\",\r\n      day: \"numeric\",\r\n    };\r\n    startingDate = new Date(projectGroupData.reviewStartingDate);\r\n    startingDate = startingDate.toLocaleDateString(\"fr-FR\", options);\r\n  }\r\n\r\n  return (\r\n    <>\r\n      {!isLoaded && <Spinner />}\r\n      {projectGroupData === undefined ? (\r\n        \"\"\r\n      ) : (\r\n        // deal with review view\r\n\r\n        <div className=\"pl-3 pt-3 pb-3 pr-3\">\r\n          <h3 className=\"\">\r\n            Mes revues des groupes de {projectGroupData?._id}\r\n          </h3>\r\n          {\r\n            /* ONLY SHOW ALL REVIEWS IF\r\n          project group status is not \"init\" or \"dev\" AND\r\n          (user is admin OR user is a project member within this group) \r\n          AND today is after the project review starting date \r\n          */\r\n            allReviewsData &&\r\n            projectGroupData &&\r\n            projectGroupData.status !== \"init\" &&\r\n            projectGroupData.status !== \"dev\" &&\r\n            ((userData && userData.isAdmin) ||\r\n              (myReviewSummaryData && myReviewSummaryData.isProjectMember)) ? (\r\n              <div>\r\n                <div className=\"summary\">                 \r\n                  <div className=\"summary__card-wrapper\">\r\n                    <MyReviewsSummary myReviewsSummary={myReviewSummaryData} />\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"index\">\r\n                  <input\r\n                    type=\"text\"\r\n                    aria-label=\"Search\"\r\n                    placeholder=\"Filtrez les contenus...\"\r\n                    onChange={handleInputChange}\r\n                    className=\"index__search\"\r\n                  />\r\n\r\n                  <MyReviews\r\n                    projects={\r\n                      filteredContents && filteredContents.length > 0\r\n                        ? filteredContents\r\n                        : myReviewsData\r\n                    }\r\n                    setFilteredContents={setFilteredContents}\r\n                    allReviews={allReviewsData}\r\n                  ></MyReviews>\r\n                </div>\r\n              </div>\r\n            ) : // deal with reasons not to show the reviews\r\n            // Deal when it is not the season\r\n            !projectGroupData ||\r\n              projectGroupData.status === \"init\" ||\r\n              projectGroupData.status === \"dev\" ? (\r\n              `La saison de revues des projets n'a pas encore été ouverte.\r\n      Nous nous réjouissons de vous revoir tout bientôt pour évaluer les projets de différents groupes.\r\n      Une annonce sera faite une fois la saison ouverte ; )\r\n      Date d'ouverture estimée : ${startingDate}`\r\n            ) : (\r\n              // Deal when it is not the right use\r\n              \"Vous n'avez pas encore le privilège de voir les revues des projets des groupes de \" +\r\n              projectGroupData._id +\r\n              \". Si nécessaire, n'hésitez pas à faire une demande à l'administrateur du site.\"\r\n            )\r\n          }\r\n        </div>\r\n      )}\r\n    </>\r\n  );\r\n};\r\nexport default MyReviewsManagement;\r\n","import React from \"react\";\r\nimport { graphql } from \"gatsby\";\r\nimport { useStaticQuery } from \"gatsby\";\r\n\r\nimport MainLayout from \"../components/main-layout\";\r\n\r\nimport { withAuthentication } from \"../components/hoc/hoc\";\r\nimport { ProjectDataProvider } from \"../components/context/projects/project-data-context\";\r\nimport { ReviewDataProvider } from \"../components/context/reviews/review-data-context\";\r\n\r\nimport MyReviewsManagement from \"../components/reviews/my-reviews-management\";\r\n\r\nconst MyReviewsPage = () => {\r\n  const data = useStaticQuery(\r\n    graphql`\r\n      query  {\r\n        site {\r\n          siteMetadata {\r\n            defaultAssociatedProjectGroupName\r\n          }\r\n        }\r\n      }\r\n    `\r\n  );\r\n\r\n  const associatedProjectGroupName =\r\n    data?.site.siteMetadata.defaultAssociatedProjectGroupName;\r\n\r\n  return (\r\n    <ProjectDataProvider>\r\n      <ReviewDataProvider>\r\n        <MainLayout>\r\n          <MyReviewsManagement\r\n            associatedProjectGroupName={associatedProjectGroupName}\r\n          />\r\n        </MainLayout>\r\n      </ReviewDataProvider>\r\n    </ProjectDataProvider>\r\n  );\r\n};\r\n\r\nconst MyReviewsPageProtected = withAuthentication(MyReviewsPage);\r\nexport default MyReviewsPageProtected;\r\n"],"names":["projects","setFilteredContents","allReviews","newProjects","map","project","sameProjectWithOtherData","find","element","convertedProjectId","_id","countExpected","countLiked","countReviews","projectReviews","length","index","key","associatedProjectGroupName","useProjectData","projectGroupData","updateProjectGroupData","userData","updateUserData","useReviewData","myReviewSummaryData","updateMyReviewSummaryData","myReviewsData","updateMyReviewsData","allReviewsData","updateAllReviewsData","isLoaded","useState","undefined","filteredContents","setQuery","useEffect","getData","startingDate","group","user","userName","console","error","Date","reviewStartingDate","toLocaleDateString","weekday","year","month","day","className","status","isAdmin","isProjectMember","myReviewsSummary","type","placeholder","onChange","e","inputText","target","value","filteredData","filter","content","shortId","name","description","toLowerCase","includes","parseInt","withAuthentication","data","useStaticQuery","site","siteMetadata","defaultAssociatedProjectGroupName"],"sourceRoot":""}