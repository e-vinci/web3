---
title: 'Module 6 : API REST avec MongoDB'
description: 'API REST avec MongoDB'
---

# Module 6 : API REST avec MongoDB
Dans ce module, nous alons revoir comment faire une API REST, mais surtout comment utiliser une base de donn√©es MongoDB pour persister nos donn√©es.

Voici les sujets trait√©s :
- a) [Rappel : cr√©ation d'une API REST](#a)
- b) [üç¨ Pour se rafraichir la m√©moire un peu plus (pas obligatoire)](#b)
- c) [Premier acc√®s √† la DB](#c)
- d) [Cr√©ation d'une API REST avec MongoDB](#d)
- e) [Gestion des erreurs](#e)
- f) [üç¨ Pour aller plus loin : Update dans la DB](#f)
- g) [A retenir](#g)
- h) [Solution des exercices](#h)

**Voici les lectures qui sont r√©f√©renc√©es dans ce module :**
- [Node.js and Express](https://fullstackopen.com/en/part3/node_js_and_express) [[R.1]](/references/#r1)
- [Saving data to MongoDB](https://fullstackopen.com/en/part3/saving_data_to_mongo_db) [[R.1]](/references/#r1)

# <a id="a"></a>a) Rappel : cr√©ation d'une API REST

Dans le cours de Web 2, vous avez appris comment faire une API REST avec Node.js. Nous vous invitons √† lire [Node.js and Express](https://fullstackopen.com/en/part3/node_js_and_express) [[R.1]](/references/#r1) pour vous raffraichir la m√©moire.

# <a id="b"></a> b) üç¨ Pour se rafraichir la m√©moire un peu plus (optionnel)

Dans la fiche lue pr√©c√©demment, il y a des exercices. Vous ne devez pas les faire. Si vous souhaitez quand m√™me les faire, libre √† vous, mais attention que la vraie mati√®re de cette s√©ance est plut√¥t port√©e sur MongoDB. Ces exercices sont consid√©r√©s comme connus. Les faire risque de vous mettre en retard sur la fiche, et vous devrez alors la terminer chez vous.

Pour les exercices 3.1 √† 3.8, ils peuvent tous √™tre faits dans le m√™me projet de mani√®re it√©rative. La solution vous sera fournie, car elle servira de base pour un exercice futur.

**Remarque :** lorsqu'il y a un souci de validation (comme dans l'exercice 3.6), nous vous invitons √† utiliser le status code 422 au lieu d'un code 400 trop g√©n√©rique.

# <a id="c"></a>c) Premier acc√®s √† la DB

Nous vous invitons √† lire la fiche [Saving data to MongoDB](https://fullstackopen.com/en/part3/saving_data_to_mongo_db) [[R.1]](/references/#r1) et faire l'exercice 3.12.

Pour faire l'exercices 12, nous vous invitons √† cr√©er un nouveau projet, par exemple dans le dossier `/exercises/module6/ex3.12` en lan√ßant la commande `npm init` dans le dossier du projet. Une fois le projet cr√©√©, il faut y installer les d√©pendances (mongoose...)

**Attention**, cet exercice ne concerne qu'un simple fichier mongo.js, √† cr√©er, qui permet de faire des op√©rations dans la DB. Il n'y a donc pas de serveur web.

# <a id="d"></a>d) Cr√©ation d'une API REST avec MongoDB

Maintenant que vous avez mis votre DB en place, et que vous avez pu y acc√©der une premi√®re fois, nous allons faire une API compl√®te.

Lisez la suite de la fiche [Saving data to MongoDB](https://fullstackopen.com/en/part3/saving_data_to_mongo_db) [[R.1]](/references/#r1) et faites les exercices 3.13 √† 3.15.

Repartez de la solution de la partie a) disponible sur Gitlab ici : [Solution module 6 rappels](https://gitlab.vinci.be/6i3-web3/2023-2024/module6-rappels). Veillez √† refactorer le code pour utiliser une structure ad√©quate et maintenable.

N'oubliez pas de faire un module s√©par√© pour l'acc√®s √† la DB, et utilisez les variables d'environnement pour donner l'URL de la DB √† votre application.

Pour l'exercice 3.13, ne travaillez que sur la route "get all", et pas sur la route "get one by id". La seconde sera faite dans un exercice bonus plus tard.

# <a id="e"></a>e) Gestion des erreurs

Faites les exercices 3.16 de la s√©ance lue pr√©c√©demment : [Saving data to MongoDB](https://fullstackopen.com/en/part3/saving_data_to_mongo_db#exercises-3-15-3-18) mais uniquement pour le cas d'erreur "malformed id". Vous ne devez pas g√©rer les autres cas pour l'instant.

# <a id="f"></a>f) üç¨ Pour aller plus loin : Update dans la DB (optionnel)

Faites les exercices 3.16, 3.17 et 3.18 de la s√©ance lue pr√©c√©demment : [Saving data to MongoDB](https://fullstackopen.com/en/part3/saving_data_to_mongo_db#exercises-3-15-3-18)

Dans l'exercices 3.16, g√©rez √† pr√©sent tous les cas d'erreur de votre application.

# <a id="g"></a>g) A retenir

* MongoDB est une base de donn√©e NoSQL qui permet de stocker des objets JSON (BSON en r√©alit√©) dans les collections. Aucune v√©rification de sch√©ma n'est effectu√©e par la DB, mais on peut faire des v√©rifications de sch√©ma c√¥t√© applicatif, ici avec Mongoose.
* Mongoose va nous connecter √† la DB, et nous proposer de cr√©er des Mod√®les, sur base de Sch√©mas. Ces mod√®les sont des fonctions "constructeur", ce qui nous donne des objets JS qui ont des m√©thodes sp√©cifiques, notamment une m√©thode "**save**" qui permet d'ajouter l'objet cr√©√© en DB.
* On n'est pas oblig√©s d'utiliser Mongoose et toutes les facilit√©s associ√©es. Il existe une driver Node.js officiel "de base" qui permet de faire toutes les op√©rations n√©cessaires sur la DB. Il ne fournit par contre pas les syst√®mes de sch√©ma, de mod√®le... Lorsque ces √©l√©ments ne vous sont pas utiles, pr√©f√©rez le driver par d√©faut.
* **ON NE MET JAMAIS LES INFORMATIONS DE CONNEXION A LA DB DANS SON CODE !!!** Ces informations sensibles (elles contiennent notamment le mot de passe) doivent √™tre extraites dans des variables d'environnement, ou de mani√®re plus simple, dans des fichiers ".env" qui ne sont pas versionn√©s.
* Le code qui nous permet de nous connecter √† la DB, les sch√©mas, les mod√®les...  doivent √™tre mis dans un module s√©par√©.

# <a id="h"></a> h) üç¨ Solution des exercices
Une solution pour les exercices de ce module se trouvent ici : [module6](https://gitlab.vinci.be/6i3-web3/2023-2024/module6).

Vous devez avoir un compte Vinci pour pouvoir y acc√©der.