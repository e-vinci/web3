---
title: 'Module 6 : API REST avec MongoDB'
description: 'API REST avec MongoDB'
---

# Module 6 : API REST avec MongoDB

Dans ce module, nous alons revoir comment faire une API REST, mais surtout comment utiliser une base de donn√©es MongoDB pour persister nos donn√©es.

<InternalPageMenu>
  <PathViewer>
    <PathViewerItem to="/"> web3course </PathViewerItem>
    <PathViewerItem to="/modules/6" selected> Module 6 </PathViewerItem>
  </PathViewer>
  <InternalPageMenuItem> Rappel : cr√©ation d'une API REST </InternalPageMenuItem>
  <InternalPageMenuItem> üç¨ Pour se rafraichir la m√©moire un peu plus (pas obligatoire) </InternalPageMenuItem>
  <InternalPageMenuItem> Premier acc√®s √† la DB </InternalPageMenuItem>
  <InternalPageMenuItem> Cr√©ation d'une API REST avec MongoDB </InternalPageMenuItem>
  <InternalPageMenuItem> Gestion des erreurs </InternalPageMenuItem>
  <InternalPageMenuItem> üç¨ Pour aller plus loin : Update dans la DB </InternalPageMenuItem>
  <InternalPageMenuItem> A retenir </InternalPageMenuItem>
  <InternalPageMenuItem> Solution des exercices </InternalPageMenuItem>
</InternalPageMenu>

**Voici les lectures qui sont r√©f√©renc√©es dans ce module :**
- [Node.js and Express](https://fullstackopen.com/en/part3/node_js_and_express) [[R.1]](/references/#r1)
- [Saving data to MongoDB](https://fullstackopen.com/en/part3/saving_data_to_mongo_db) [[R.1]](/references/#r1)

# <InternalPageTitle> Rappel : cr√©ation d'une API REST </InternalPageTitle>

Dans le cours de Web 2, vous avez appris comment faire une API REST avec Node.js. Nous vous invitons √† lire [Node.js and Express](https://fullstackopen.com/en/part3/node_js_and_express) [[R.1]](/references/#r1) pour vous raffraichir la m√©moire.

# <InternalPageTitle> üç¨ Pour se rafraichir la m√©moire un peu plus (optionnel) </InternalPageTitle>

Dans la fiche lue pr√©c√©demment, il y a des exercices. Vous ne devez pas les faire. Si vous souhaitez quand m√™me les faire, libre √† vous, mais attention que la vraie mati√®re de cette s√©ance est plut√¥t port√©e sur MongoDB. Ces exercices sont consid√©r√©s comme connus. Les faire risque de vous mettre en retard sur la fiche, et vous devrez alors la terminer chez vous.

Pour les exercices 3.1 √† 3.8, ils peuvent tous √™tre faits dans le m√™me projet de mani√®re it√©rative. La solution vous sera fournie, car elle servira de base pour un exercice futur.

**Remarque :** lorsqu'il y a un souci de validation (comme dans l'exercice 3.6), nous vous invitons √† utiliser le status code 422 au lieu d'un code 400 trop g√©n√©rique.

# <InternalPageTitle> Premier acc√®s √† la DB </InternalPageTitle>

Nous vous invitons √† lire la fiche [Saving data to MongoDB](https://fullstackopen.com/en/part3/saving_data_to_mongo_db) [[R.1]](/references/#r1) et faire l'exercice 3.12.

Pour faire cet exercice 3.12, nous vous invitons √† cr√©er un nouveau projet, par exemple dans le dossier `/exercises/module6/6.1` en lan√ßant la commande `npm init` dans le dossier du projet. Une fois le projet cr√©√©, il faut y installer les d√©pendances (mongoose...)

**Attention**, cet exercice ne concerne qu'un simple fichier mongo.js, √† cr√©er, qui permet de faire des op√©rations dans la DB. Il n'y a donc pas de serveur web.

**Rappel**: ne stockez jamais vos mots de passe dans vos fichiers source!

# <InternalPageTitle> Cr√©ation d'une API REST avec MongoDB </InternalPageTitle>

Maintenant que vous avez mis votre DB en place, et que vous avez pu y acc√©der une premi√®re fois, nous allons faire une API compl√®te.

Lisez la suite de la fiche [Saving data to MongoDB](https://fullstackopen.com/en/part3/saving_data_to_mongo_db) [[R.1]](/references/#r1) et faites les exercices 3.13 √† 3.15:

* Nous avons cr√©√© un squelette d'application que vous pouvez utiliser et refactoriser comme demand√© dans les exercices
* Copiez le contenu de [mongodb-starter](https://github.com/e-vinci/web3-exercises/tree/main/tutorials/mongodb-starter) dans `/exercises/module6/6.2`
* Refactorisez le code comme d√©crit dans les exercices 3.13 √† 3.15
* N'oubliez pas de faire un module s√©par√© pour l'acc√®s √† la DB et utilisez les variables d'environnement pour donner l'URL de la DB √† votre application.
* Le squelette de projet contient un fichier `requests.http` que vous pouvez utiliser depuis VS Code pour tester les APIs.
* Vous pouvez √©galement utiliser l'application frontend que vous avez cr√©√©e au module4 (ex. 4.2 ou 4.1) en conjonction avec votre projet d'APIs, cela devrait normalement fonctionner sans besoin de modifier le code du frontend.


# <InternalPageTitle> Gestion des erreurs </InternalPageTitle>

Faites les exercices 3.16 de la s√©ance lue pr√©c√©demment ([Saving data to MongoDB](https://fullstackopen.com/en/part3/saving_data_to_mongo_db#exercises-3-15-3-18)) mais uniquement pour le cas d'erreur "malformed id". Vous ne devez pas g√©rer les autres cas pour l'instant.

# <InternalPageTitle> üç¨ Pour aller plus loin : Update dans la DB (optionnel) </InternalPageTitle>

Faites les exercices 3.16, 3.17 et 3.18 de la s√©ance lue pr√©c√©demment ([Saving data to MongoDB](https://fullstackopen.com/en/part3/saving_data_to_mongo_db#exercises-3-15-3-18))

Dans l'exercices 3.16, g√©rez √† pr√©sent tous les cas d'erreur de votre application.

# <InternalPageTitle> A retenir </InternalPageTitle>

* MongoDB est une base de donn√©e NoSQL qui permet de stocker des objets JSON (BSON en r√©alit√©) dans les collections. Aucune v√©rification de sch√©ma n'est effectu√©e par la DB, mais on peut faire des v√©rifications de sch√©ma c√¥t√© applicatif, ici avec Mongoose.
* Mongoose va nous connecter √† la DB, et nous proposer de cr√©er des Mod√®les, sur base de Sch√©mas. Ces mod√®les sont des fonctions "constructeur", ce qui nous donne des objets JS qui ont des m√©thodes sp√©cifiques, notamment une m√©thode "**save**" qui permet d'ajouter l'objet cr√©√© en DB.
* On n'est pas oblig√©s d'utiliser Mongoose et toutes les facilit√©s associ√©es. Il existe une driver Node.js officiel "de base" qui permet de faire toutes les op√©rations n√©cessaires sur la DB. Il ne fournit par contre pas les syst√®mes de sch√©ma, de mod√®le... Lorsque ces √©l√©ments ne vous sont pas utiles, pr√©f√©rez le driver par d√©faut.
* **ON NE MET JAMAIS LES INFORMATIONS DE CONNEXION A LA DB DANS SON CODE !!!** Ces informations sensibles (elles contiennent notamment le mot de passe) doivent √™tre extraites dans des variables d'environnement, ou de mani√®re plus simple, dans des fichiers ".env" qui ne sont pas versionn√©s.
* Le code qui nous permet de nous connecter √† la DB, les sch√©mas, les mod√®les...  doivent √™tre mis dans un module s√©par√©.

# <InternalPageTitle> üç¨ Solution des exercices </InternalPageTitle>

Une solution pour les exercices de ce module se trouvent ici : [module6](https://github.com/e-vinci/web3-exercises/tree/main/exercises/module6)

N'h√©sitez pas √† utiliser https://download-directory.github.io/ pour t√©l√©charger le dossier complet (sans devoir cloner tout le repo **`web3-exercises`**). Vous devez juste indiquer le lien vers le dossier **`module6`** dans le champ **`Download Directory`** : https://github.com/e-vinci/web3-exercises/tree/main/exercises/module6 puis taper sur la touche **`Enter`** de votre clavier.
