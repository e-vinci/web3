---
title: "Module 8 : GraphQL"
description: "Module 8 : GraphQL"
---

# Module 8 : GraphQL

Voici les sujets trait√©s :
- a) [Serveur GraphQL](#a)
- b) [Client GraphQL avec React](#b)
- c) [R√©sum√©](#c)
  - c.1) [Appolo Server (back - Node.js)](#c1)
  - c.2) [Appolo Client (front - React)](#c2)
- d) [üç¨ Pour s‚Äôentra√Æner un peu plus (optionnel)](#d)
- e) [üç¨ Et si vous en voulez encore... (optionnel)](#e)
- f) [Solution des exercices](#f)

**Voici les lectures qui sont r√©f√©renc√©es dans ce module :**
- [GraphQL-server](https://fullstackopen.com/en/part8/graph_ql_server) [[R.1]](/references/#r1)
- [React and GraphQL](https://fullstackopen.com/en/part8/react_and_graph_ql) [[R.1]](/references/#r1)

# <a id="a"></a>a) Serveur GraphQL

Veuillez lire le chapitre sur GraphQL et la cr√©ation d'un serveur avec Appolo server : [GraphQL-server](https://fullstackopen.com/en/part8/graph_ql_server) [[R.1]](/references/#r1)

Cr√©ez un dossier `/exercises/module8/library-backend` dans votre repo local. C'est dans ce dossier que vous ferez tous les exercices de cette partie a).

Faites les exercices 8.1 √† 8.7 en n'oubliant pas de repartir du fichier de base donn√© (√† copier dans le dossier cr√©√© pr√©c√©demment) : [Exercises 8.1-8.7](https://fullstackopen.com/en/part8/graph_ql_server#exercises-8-1-8-7) [[R.1]](/references/#r1).

Pour vous simplifier la vie lors du d√©veloppement, nous allons installer un petit outil qui va red√©marrer automatiquement notre server Node.js d√®s qu'on fait une modification dans notre code : [Nodemon](https://nodemon.io/). Dans votre projet, √©crivez la commande `npm install --save-dev nodemon`. Et dans votre `package.json`, ajoutez/modifiez le script start pour qu'il ressemble √† ceci : `"start": "nodemon library-backend.js",`

Maintenant, lancez votre projet avec la commande : `npm start`, et observez que l'application est relanc√©e automatiquement d√®s qu'un changement est effectu√© dans le code.

# <a id="b"></a>b) Client GraphQL avec React

Veuillez lire le chapitre sur l'int√©gration d'un client GraphQL dans une application React : [React and GraphQL](https://fullstackopen.com/en/part8/react_and_graph_ql) [[R.1]](/references/#r1)

Faites les exercices 8.8 √† 8.11 en n'oubliant pas de repartir du projet de base donn√© : [Exercises 8.1-8.7](https://fullstackopen.com/en/part8/graph_ql_server#exercises-8-1-8-7) [[R.1]](/references/#r1).

Pour importer le projet, dans votre dossier `/exercises/module8/` de votre repo local, faites un git clone du projet dans le dossier. Vous aurez alors deux dossiers dans `/exercises/module8/` : un pour le front-end et un pour le back-end. N'oubliez pas de supprimer le dossier `.git` du projet clon√©, sinon vous aurez un repo dans un repo.

Nous vous invitons √† extraire les querries GQL dans un fichier √† part. Celui-ci pourrait ressembler √† quelque-chose comme √ßa :

```js
import { gql } from '@apollo/client'

const ALL_PERSONS = gql`
  query {
    allPersons {
      name
      phone
      id
    }
  }
`

export { ALL_PERSONS }
```

Ceci nous permettra plus facilement de r√©-utiliser des querries qui sont utilis√©es √† plusieurs endroits.

# <a id="c"></a>c) R√©sum√©

- La philosophie de GraphQL est fort diff√©rente du REST. En REST, on re√ßoit toute la ressource, m√™me ce dont on n'a pas besoin, et si on veut des √©l√©ments "imbriqu√©s", il faut les demander s√©par√©ment, ou faire une requ√™te sp√©cifique. En GraphQL, on re√ßoit uniquement ce qu'on demande, et on peut demander directement des √©l√©ments imbriqu√©s.
- Lorsqu'on fait une Query GraphQL, par d√©faut on ne re√ßoit rien, il faut explicitement demander ce qu'on veut recevoir.

## <a id="c1"></a> c.1) Appolo Server (back - Node.js)

- En REST avec express, on √©crit une fonction JS qui sera ex√©cut√©e pour une requ√™te (une fonction par requ√™te). En GraphQL avec Appolo, on √©crit plut√¥t des **resolvers** pour chaque **field** de chaque ressource, et des **mutations**. Ceci nous permet, du c√¥t√© client de faire des requ√™tes "personnalis√©es" en fonction des besoins (on choisit ce qu'on r√©cup√®re).
- Les **mutations** ont un nom et un certain nombre de param√®tres. Ceci permet une lisibilit√© de l'API, mais implique √©galement la n√©cessit√© de r√©fl√©chir √† une mani√®re de structurer/nommer les requ√™tes.
- Appolo Server nous propose un outil pour parcourir la structure de l'API et construire des requ√™tes facilement. Son usage est recommand√© pour construire nos requ√™tes utilis√©es c√¥t√© serveur.
- Appolo Server s'occupe en grande partie de la gestion des erreurs, gr√¢ce aux **sch√©mas**. Si le client ne respecte pas le sch√©ma, ou le format des mutations, Appolo est capable de le d√©tecter seul. On ne doit donc s'occuper que de la gestion des erreurs "business".

## <a id="c1"></a> c.1) Appolo Client (front - React)

- Appolo Client met √† disposition un hook **useQuery()** qui permet d'ex√©cuter une query √† la premi√®re ex√©cution du hook, et d'en r√©cup√©rer le r√©sultat (√©tat de chargement, donn√©es...).
- Un m√©canisme de **cache** permet de partager le r√©sultat des requ√™tes dans toute l'application, et donc d'√©viter de refaire des requ√™tes inutiles.
- Lors d'une **mutation**, on peut d√©finir une requ√™te √† ex√©cuter pour mettre √† jour le cache, et donc rafraichir les composants qui en d√©pendent.
- Attention, la mise √† jour du cache est locale au client. Si plusieurs machines acc√®dent √† l'application, et l'une d'elle fait une mutation, les autres ne seront pas au courant. Pour palier √† cela (pour autant que ce soit n√©cessaire) on peut d√©finir un "**pollInterval**" pour une **Query**, ce qui va l'ex√©cuter √† intervalle r√©gulier, et donc mettre √† jour le cache si les donn√©es ont chang√©es sur le serveur.
- L'√©tat d'une application web est souvent compos√©e d'√©l√©ments r√©cup√©r√©s depuis le serveur. Appolo client s'occupant de cela, on ne doit plus utiliser **useState()** pour le stocker.

# <a id="d"></a>d) üç¨ Pour s‚Äôentra√Æner un peu plus (optionnel)

Faites l'exercice 8.12 [Exercises 8.8-8.12](https://fullstackopen.com/en/part8/react_and_graph_ql#exercises-8-8-8-12) [[R.1]](/references/#r1).

# <a id="e"></a>e) üç¨ Et si vous en voulez encore... (optionnel)

N'h√©sitez pas √† lire la fiche suivante et faire des exercices : [Database and user administration](https://fullstackopen.com/en/part8/database_and_user_administration) [[R.1]](/references/#r1).

# <a id="f"></a> f) üç¨ Solution des exercices
Une solution pour les exercices de ce module se trouvent ici : [module8](https://gitlab.vinci.be/6i3-web3/2023-2024/module8.git).

Vous devez avoir un compte Vinci pour pouvoir y acc√©der.