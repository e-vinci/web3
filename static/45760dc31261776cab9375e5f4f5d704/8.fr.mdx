---
title: "Module 8 : GraphQL"
description: "Module 8 : GraphQL"
---

# Module 8 : GraphQL

<InternalPageMenu>
  <PathViewer>
    <PathViewerItem to="/"> web3course </PathViewerItem>
    <PathViewerItem to="/modules/8" selected> Module 8 </PathViewerItem>
  </PathViewer>
  <InternalPageMenuItem> Serveur GraphQL </InternalPageMenuItem>
  <InternalPageMenuItem> Client GraphQL avec React </InternalPageMenuItem>
  <InternalPageMenuItem> R√©sum√© </InternalPageMenuItem>
  <InternalPageMenuItem> üç¨ Pour s‚Äôentra√Æner un peu plus (optionnel) </InternalPageMenuItem>
  <InternalPageMenuItem> üç¨ Et si vous en voulez encore... (optionnel) </InternalPageMenuItem>
  <InternalPageMenuItem> Solution des exercices </InternalPageMenuItem>
</InternalPageMenu>


**Voici les lectures qui sont r√©f√©renc√©es dans ce module :**
- [GraphQL-server](https://fullstackopen.com/en/part8/graph_ql_server) [[R.1]](/references/#r1)
- [React and GraphQL](https://fullstackopen.com/en/part8/react_and_graph_ql) [[R.1]](/references/#r1)

# <InternalPageTitle> Serveur GraphQL </InternalPageTitle>

Veuillez lire le chapitre sur GraphQL et la cr√©ation d'un serveur avec Appolo server : [GraphQL-server](https://fullstackopen.com/en/part8/graph_ql_server) [[R.1]](/references/#r1)

Cr√©ez un dossier `/exercises/module8/library-backend` dans votre repo local. C'est dans ce dossier que vous ferez tous les exercices de cette premi√®re partie.

Faites les exercices 8.1 √† 8.7 en n'oubliant pas de commencer avec le fichier de base donn√© dans l'introduction des exercices (`library-backend.js`) : [Exercises 8.1-8.7](https://fullstackopen.com/en/part8/graph_ql_server#exercises-8-1-8-7) [[R.1]](/references/#r1).

Pour vous simplifier la vie lors du d√©veloppement, nous allons installer un petit outil qui va red√©marrer automatiquement notre server Node.js d√®s qu'on fait une modification dans notre code : [Nodemon](https://nodemon.io/). Dans votre projet, √©crivez la commande `npm install --save-dev nodemon`. Et dans votre `package.json`, ajoutez/modifiez le script start pour qu'il ressemble √† ceci : `"start": "nodemon library-backend.js",`

Maintenant, lancez votre projet avec la commande : `npm start`, et observez que l'application est relanc√©e automatiquement d√®s qu'un changement est effectu√© dans le code.

# <InternalPageTitle> Client GraphQL avec React </InternalPageTitle>

Veuillez lire le chapitre sur l'int√©gration d'un client GraphQL dans une application React : [React and GraphQL](https://fullstackopen.com/en/part8/react_and_graph_ql) [[R.1]](/references/#r1)

Cr√©ez un dossier `/exercises/module8/library-frontend` dans votre repo local.

Faites les exercices 8.8 √† 8.11 en n'oubliant pas de partir du projet de base donn√© dans l'introduction des exercices : [Exercises 8.8-8.12](https://fullstackopen.com/en/part8/react_and_graph_ql#exercises-8-8-8-12) [[R.1]](/references/#r1).

Nous vous invitons √† extraire les queries GraphQL dans un fichier √† part. Celui-ci pourrait ressembler √† :

```js
import { gql } from '@apollo/client'

const ALL_PERSONS = gql`
  query {
    allPersons {
      name
      phone
      id
    }
  }
`

export { ALL_PERSONS }
```

Ceci nous permettra plus facilement de r√©-utiliser des queries qui sont utilis√©es √† plusieurs endroits.

# <InternalPageTitle> R√©sum√© </InternalPageTitle>

- La philosophie de GraphQL est fort diff√©rente du REST:

  * En REST, on d√©fini une API pour chaque resource et on y acc√®de via les diff√©rents verbes HTTP (GET=lire, POST=cr√©er, PUT=modifier, etc.). Sauf si l'on param√©trise ces APIs, on re√ßoit en g√©n√©ral la resource en entier (m√™me ce dont on n'a pas besoin). Si l'on veut acc√©der √† des √©l√©ments imbriqu√©s il faut faire plusieurs appels aux diff√©rentes APIs.
  * En GraphQL, on a une API unique acc√©d√©e par un POST et on y indique la ou les op√©rations souhait√©es ainsi que les r√©sultats d√©sir√©s. C'est donc plus efficace en terme d'appels d'APIs et aussi beaucoup plus flexible en terme d'indication des op√©rations et des r√©sultats souhait√©s.

- Lorsqu'on fait une query GraphQL, par d√©faut on ne re√ßoit rien, il faut explicitement demander ce qu'on veut recevoir.

## Appolo Server (back - Node.js)

- En REST avec express, on √©crit une fonction JS qui sera ex√©cut√©e pour une requ√™te (une fonction par requ√™te). En GraphQL avec Appolo, on √©crit plut√¥t des **resolvers** pour chaque **field** de chaque ressource, et des **mutations**. Ceci nous permet, du c√¥t√© client de faire des requ√™tes "personnalis√©es" en fonction des besoins (on choisit ce qu'on r√©cup√®re).
- Les **mutations** ont un nom et un certain nombre de param√®tres. Ceci permet une lisibilit√© de l'API, mais implique √©galement la n√©cessit√© de r√©fl√©chir √† une mani√®re de structurer/nommer les requ√™tes.
- Appolo Server nous propose un outil pour parcourir la structure de l'API et construire des requ√™tes facilement. Son usage est recommand√© pour construire nos requ√™tes utilis√©es c√¥t√© serveur.
- Appolo Server s'occupe en grande partie de la gestion des erreurs, gr√¢ce aux **sch√©mas**. Si le client ne respecte pas le sch√©ma, ou le format des mutations, Appolo est capable de le d√©tecter seul. On ne doit donc s'occuper que de la gestion des erreurs "business".

## Appolo Client (front - React)

- Appolo Client met √† disposition un hook **`useQuery()`** qui permet d'ex√©cuter une query √† la premi√®re ex√©cution du hook, et d'en r√©cup√©rer le r√©sultat (√©tat de chargement, donn√©es...).
- Un m√©canisme de **cache** permet de partager le r√©sultat des requ√™tes dans toute l'application, et donc d'√©viter de refaire des requ√™tes inutiles.
- Lors d'une **mutation**, on peut d√©finir une requ√™te √† ex√©cuter pour mettre √† jour le cache, et donc rafraichir les composants qui en d√©pendent.
- Attention, la mise √† jour du cache est locale au client. Si plusieurs machines acc√®dent √† l'application, et l'une d'elle fait une mutation, les autres ne seront pas au courant. Pour palier √† cela (pour autant que ce soit n√©cessaire) on peut d√©finir un "**pollInterval**" pour une query, ce qui va l'ex√©cuter √† intervalle r√©gulier, et donc mettre √† jour le cache si les donn√©es ont chang√© sur le serveur.
- L'√©tat d'une application web est souvent compos√© d'√©l√©ments r√©cup√©r√©s depuis le serveur. Appolo client s'occupant de cela, on ne doit plus utiliser **useState()** pour le stocker.

# <InternalPageTitle> üç¨ Pour s‚Äôentra√Æner un peu plus (optionnel) </InternalPageTitle>

Faites l'exercice 8.12 [Exercises 8.8-8.12](https://fullstackopen.com/en/part8/react_and_graph_ql#exercises-8-8-8-12) [[R.1]](/references/#r1).

# <InternalPageTitle> üç¨ Et si vous en voulez encore... (optionnel) </InternalPageTitle>

N'h√©sitez pas √† lire la fiche suivante et faire des exercices : [Database and user administration](https://fullstackopen.com/en/part8/database_and_user_administration) [[R.1]](/references/#r1).

# <InternalPageTitle> Solution des exercices </InternalPageTitle>

Une solution pour les exercices de ce module se trouvent ici : [module8](https://github.com/e-vinci/web3-exercises/tree/main/exercises/module8).

N'h√©sitez pas √† utiliser https://download-directory.github.io/ pour t√©l√©charger le dossier complet (sans devoir cloner tout le repo **`web3-exercises`**). Vous devez juste indiquer le lien vers le dossier **`module8`** dans le champ **`Download Directory`** : https://github.com/e-vinci/web3-exercises/tree/main/exercises/module8 puis taper sur la touche **`Enter`** de votre clavier.
